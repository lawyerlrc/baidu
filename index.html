<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>999</title>
</head>
<body>
Octokit

<script type="text/javascript">
//获取#后参数
//    let params = (new URL(document.location)).searchParams;
//    let access_token = params.get('access_token'); 
//    let expires_in = params.get('expires_in'); 
//    let session_secret = params.get('session_secret'); 
//    let session_key = params.get('session_key'); 
//    let scope = params.get('scope'); 
//    let content = 'access_token=' + access_token + '&expires_in=' + expires_in + '&session_secret=' + session_secret + '&session_key=' + session_key + '&scope=' + scope;
//    alert('access_token:' + access_token);
//    alert('content:'+ content);
    alert(window.location.href);
//获取URL
var str = window.location.href;
    
//将参数存入数组arr
var str=str.substring(str.search("#")+1);
var arr=str.split("&");
    
//初始化最终存储数据的数组data
var data = {expires_in:"01", access_token:"02", session_secret:"03",session_key:"04",scope:"05"};

//开始写入数据
var c="";
var z="";
for (i=0;i<arr.length;i++){
    c = arr[i].substring(0,arr[i].search("="));        //"expires_in"
    z = arr[i].substring(arr[i].search("=")+1);        //expires_in的值
    data[c]=z;
}
    alert('content:'+ content);
</script>

<script  type="module">
    
    import { Octokit, App } from "https://cdn.skypack.dev/octokit";
    let gtoken = 'ghp_'+'bpjctXGGmL9hneXBGWHbc5e0oyvV8D3XhTkD';
//函数
    async function dogithub(){
      //函数开始
      alert('dogithub beginning...');
        
      //建立对象octokit
      const octokit = new Octokit({ auth: gtoken });
      const {
            data: { login },
      } = await octokit.rest.users.getAuthenticated();
        
    //测试登陆
    alert(login);
        
    //读取data.txt数据
    const { data } = await octokit.rest.repos.getContent({
      mediaType: {
        format: "raw",
      },
      owner: "lawyerlrc",
      repo: "baidu",
      path: "data.txt",
    });
    alert('data='+ data);
        
    //写入access_token
    if (content){
        await octokit.rest.issues.create({
          owner: "lawyerlrc",
          repo: "baidu",
          title: "access_token",
          body: content,
        })
    }
    //函数结束
    alert('end')
};  
    
dogithub();

</script>
</body>
</html>
